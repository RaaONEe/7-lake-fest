<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="og: https://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>IIM Calcutta | 7 Lake Fest – Scoreboard</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Poppins:300,400,500,600,700,800,900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --brand-blue:#0d2a5a;
      --text:#0f1222;
      --muted:#667085;
      --bg:#fff;
      --card:#fff;
      --line:#e6e8f0;
      --warn:#e37400;
      --ok:#16a34a;
      --shadow-sm:0 2px 10px rgba(16,24,40,.06);
      --shadow-md:0 12px 28px rgba(16,24,40,.14);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:"Source Sans Pro","Poppins","Segoe UI",Arial,Helvetica,sans-serif}
    img{max-width:100%;height:auto;display:block}
    a{text-decoration:none;color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:0 16px}

    /* HEADER (same as event pages) */
    .site{min-height:100vh;display:flex;flex-direction:column}
    main{flex:1 0 auto}
    .site-header{background:#fff;border-bottom:1px solid #eef0f5;position:relative;z-index:5}
    .header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:60px;width:auto}
    nav ul{list-style:none;display:flex;gap:20px;margin:0;padding:0}
    nav a{color:#000;font-weight:600}
    nav a[aria-current="page"]{color:var(--brand-blue)}

    /* Page intro + controls */
    .page-head{padding:18px 0 6px}
    .crumbs{color:#415269;font-weight:700;font-size:.92rem}
    .crumbs a{color:#415269}
    .crumbs .sep{opacity:.6;margin:0 .35rem}

    .headline{display:flex;flex-wrap:wrap;align-items:flex-end;justify-content:space-between;gap:12px;margin:8px 0 10px}
    .headline h1{margin:.2rem 0 0;font-weight:900;letter-spacing:.01em}
    .controls{display:flex;flex-wrap:wrap;gap:10px}
    .search{position:relative;min-width:260px;flex:1}
    .search input{width:100%;border:1px solid var(--line);border-radius:12px;padding:.8rem 1rem;font-size:1rem;box-shadow:var(--shadow-sm)}
    .filter{display:flex;gap:8px}
    .chip{border:1px solid var(--line);border-radius:999px;padding:.45rem .8rem;background:#fff;cursor:pointer;font-weight:800}
    .chip[aria-pressed="true"]{background:var(--brand-blue);color:#fff;border-color:var(--brand-blue)}

    /* Sections */
    .section{margin:16px 0}
    .section h2{font-weight:900;margin:0 0 10px}
    .note{color:var(--muted);font-weight:600;margin:0 0 8px}

    /* Cards list */
    .list{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:720px){.list{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px 14px;box-shadow:var(--shadow-sm);display:flex;gap:12px;align-items:center}
    .left{flex:1 1 auto;min-width:0}
    .title{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .title strong{font-size:1.02rem}
    .meta{display:flex;flex-wrap:wrap;gap:12px;color:#3a4251;font-weight:800;margin-top:4px}
    .pill{padding:3px 10px;border-radius:999px;color:#fff;font-weight:900;font-size:.78rem;letter-spacing:.02em}
    .pill.live{background:var(--warn)}
    .pill.done{background:#475467}
    .pill.upcoming{background:var(--brand-blue)}
    .scores{display:flex;align-items:center;gap:8px;font-weight:900}
    .vs{opacity:.6}
    .right{display:flex;align-items:center;gap:12px}
    .mini{color:var(--muted);font-size:.88rem;font-weight:800}

    /* Table (optional view toggle-ready) */
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .tr{display:grid;grid-template-columns:1.2fr .9fr .8fr .7fr;gap:12px;align-items:center;background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px 12px;box-shadow:var(--shadow-sm)}
    .th{color:#475467;font-weight:900}

    /* Footer (same look) */
    .footer{background:#0b0e17;color:#ddd}
    .footer a{color:#ddd}
    .footer .wrap{display:grid;grid-template-columns:repeat(4,1fr);gap:24px;padding:32px 16px}
    @media(max-width:900px){.footer .wrap{grid-template-columns:1fr}}
    .site-info{border-top:1px solid #222;padding:12px 16px;text-align:center}
    .socials{display:flex;gap:14px;justify-content:center;margin-bottom:10px}
  </style>
</head>

<body>
  <div class="site">

    <!-- HEADER -->
    <header class="site-header">
      <div class="wrap header-inner">
        <div class="brand">
          <a href="#">
            <!-- IIMC crest placeholder -->
            <img src="https://upload.wikimedia.org/wikipedia/en/5/59/IIM_Calcutta_Logo.svg" alt="IIM Calcutta">
          </a>
          <h1 style="margin:0;font-size:1.1rem;">
            <a href="#" style="text-decoration:none;color:#000;">IIM Calcutta</a>
          </h1>
        </div>

        <div class="brand">
          <!-- 7 Lake Fest logo placeholder -->
          <a href="#">
            <img src="https://dummyimage.com/420x120/0d2a5a/ffffff&text=7+Lake+Fest" alt="7 Lake Fest Logo">
          </a>
        </div>

        <nav aria-label="Main Menu">
          <ul>
            <li><a href="#">Events</a></li>
            <li><a href="#">Pro Nites</a></li>
            <li><a href="#">Workshops</a></li>
            <li><a href="#">Speakers</a></li>
            <li><a href="#">Informals</a></li>
            <li><a href="#" aria-current="page">Scoreboard</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <!-- Breadcrumb -->
      <section class="page-head">
        <div class="wrap">
          <div class="crumbs" aria-label="Breadcrumb">
            <a href="#">Home</a>
            <span class="sep">»</span>
            <a href="#">Events</a>
            <span class="sep">»</span>
            <span aria-current="page">Scoreboard</span>
          </div>
        </div>
      </section>

      <!-- Headline + Controls -->
      <section class="wrap">
        <div class="headline">
          <h1>Scoreboard</h1>
          <div class="controls" role="group" aria-label="Scoreboard controls">
            <div class="search" role="search">
              <label class="sr-only" for="q">Search</label>
              <input id="q" type="search" placeholder="Search event or team…" autocomplete="off" />
            </div>
            <div class="filter" aria-label="Category filter">
              <button class="chip" data-filter="all" aria-pressed="true">All</button>
              <button class="chip" data-filter="games" aria-pressed="false">Games</button>
              <button class="chip" data-filter="cultural" aria-pressed="false">Cultural</button>
              <button class="chip" data-filter="workshop" aria-pressed="false">Workshops</button>
              <button class="chip" data-filter="other" aria-pressed="false">Others</button>
            </div>
          </div>
        </div>
        <p class="note">Auto-refreshes every 15 seconds • Times shown in your local time</p>
      </section>

      <!-- Lists -->
      <section class="wrap section" id="liveSec" hidden>
        <h2>🔴 Live Now</h2>
        <div class="list" id="liveList" role="list"></div>
      </section>

      <section class="wrap section" id="recentSec" hidden>
        <h2>🆕 Latest Results</h2>
        <div class="list" id="recentList" role="list"></div>
      </section>

      <section class="wrap section" id="olderSec" hidden>
        <h2>📜 Earlier Today &amp; Older</h2>
        <div class="list" id="olderList" role="list"></div>
      </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="wrap">
        <div>
          <img src="https://dummyimage.com/260x100/ffffff/000000&text=IIM+Calcutta+|+7+Lake+Fest" alt="IIMC | 7 Lake Fest" style="width:260px;height:auto;display:block">
        </div>
        <div>
          <h3 style="margin-top:0">Address</h3>
          <ul style="list-style:none;padding-left:0;line-height:1.8">
            <li>Indian Institute of Management Calcutta, Joka</li>
            <li><a href="mailto:fest@iimcal.ac.in">fest@iimcal.ac.in</a></li>
          </ul>
        </div>
        <div>
          <h3 style="margin-top:0">Explore</h3>
          <p><a href="#">All Events →</a></p>
          <p><a href="#">Pro Nites →</a></p>
        </div>
        <div>
          <h3 style="margin-top:0">Contact</h3>
          <p><a href="#">Reach the team →</a></p>
        </div>
      </div>

      <div class="site-info">
        <div class="socials">
          <a href="#" aria-label="Facebook">Facebook</a>
          <a href="#" aria-label="Instagram">Instagram</a>
          <a href="#" aria-label="X">X</a>
          <a href="#" aria-label="LinkedIn">LinkedIn</a>
        </div>
        <div>
          <a href="#">IIM Calcutta | 7 Lake Fest</a> |
          Design &amp; Development: <a href="#" target="_blank" rel="noopener">Digital Team</a> |
          &copy; <span id="year"></span> All rights reserved
        </div>
      </div>
    </footer>
  </div>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ---------- CONFIG ----------
    // Plug in your API endpoint returning an array of items like:
    // {
    //   id: "uniq",
    //   title: "Football: IIMC vs IITK",
    //   category: "games" | "cultural" | "workshop" | "other",
    //   status: "live" | "done" | "upcoming",
    //   startTime: "2025-01-17T15:00:00+05:30",
    //   endTime: "2025-01-17T16:10:00+05:30" | null,
    //   venue: "Main Ground",
    //   teams: ["IIMC","IITK"] | null,
    //   score: "2 - 1" | null,
    //   note: "Halftime" | "Final" | null
    // }
    const API_URL = '/api/scoreboard'; // change to your real endpoint

    // ---------- FALLBACK SAMPLE DATA ----------
    const SAMPLE = [
      {
        id:"m1",
        title:"Football (Knockout): IIMC vs XIMB",
        category:"games",
        status:"live",
        startTime:addMinutesToNow(-25).toISOString(),
        endTime:null,
        venue:"Main Ground",
        teams:["IIMC","XIMB"],
        score:"1 - 0",
        note:"41’ — 1st Half"
      },
      {
        id:"c1",
        title:"Solo Music Finals",
        category:"cultural",
        status:"done",
        startTime:addMinutesToNow(-95).toISOString(),
        endTime:addMinutesToNow(-20).toISOString(),
        venue:"Auditorium",
        teams:null,
        score:null,
        note:"Winner: Priya Sharma"
      },
      {
        id:"m2",
        title:"Table Tennis (Singles): IIMC vs IIMB",
        category:"games",
        status:"upcoming",
        startTime:addMinutesToNow(35).toISOString(),
        endTime:null,
        venue:"Indoor Arena",
        teams:["IIMC","IIMB"],
        score:null,
        note:"Reporting 10 mins before"
      },
      {
        id:"m3",
        title:"Basketball: IIMC vs XLRI",
        category:"games",
        status:"done",
        startTime:addMinutesToNow(-240).toISOString(),
        endTime:addMinutesToNow(-150).toISOString(),
        venue:"Court A",
        teams:["IIMC","XLRI"],
        score:"68 - 64",
        note:"Final"
      },
      {
        id:"w1",
        title:"Dance Workshop by Zenith Crew",
        category:"workshop",
        status:"done",
        startTime:addMinutesToNow(-200).toISOString(),
        endTime:addMinutesToNow(-120).toISOString(),
        venue:"Lakefront Stage",
        teams:null,
        score:null,
        note:"Closed"
      },
      {
        id:"o1",
        title:"Photography On-the-Spot Challenge",
        category:"other",
        status:"live",
        startTime:addMinutesToNow(-10).toISOString(),
        endTime:null,
        venue:"Around Campus",
        teams:null,
        score:null,
        note:"Submissions open"
      }
    ];

    function addMinutesToNow(min){
      const d=new Date(); d.setMinutes(d.getMinutes()+min); return d;
    }

    // ---------- STATE ----------
    let rawData = [];
    let activeFilter = 'all';
    let query = '';

    // ---------- DOM ----------
    const q = document.getElementById('q');
    const chips = Array.from(document.querySelectorAll('.chip'));
    const liveSec = document.getElementById('liveSec');
    const recentSec = document.getElementById('recentSec');
    const olderSec = document.getElementById('olderSec');
    const liveList = document.getElementById('liveList');
    const recentList = document.getElementById('recentList');
    const olderList = document.getElementById('olderList');

    // ---------- EVENTS ----------
    q.addEventListener('input', () => {
      query = q.value.trim().toLowerCase();
      render();
    });

    chips.forEach(ch => {
      ch.addEventListener('click', () => {
        chips.forEach(c => c.setAttribute('aria-pressed','false'));
        ch.setAttribute('aria-pressed','true');
        activeFilter = ch.dataset.filter;
        render();
      });
    });

    // ---------- FETCH / POLL ----------
    async function fetchData(){
      try{
        const res = await fetch(API_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP '+res.status);
        const json = await res.json();
        if(Array.isArray(json)) {
          rawData = json;
        } else {
          throw new Error('Invalid payload');
        }
      }catch(err){
        // Fallback to SAMPLE if API not ready
        rawData = SAMPLE;
      }
      render();
    }

    fetchData();
    setInterval(fetchData, 15000); // 15s poll

    // ---------- RENDER ----------
    function render(){
      const now = new Date();

      // Filter by category
      let filtered = rawData.filter(it => {
        if(activeFilter !== 'all' && it.category !== activeFilter) return false;
        if(query){
          const hay = [
            it.title || '',
            (it.venue || ''),
            (it.note || ''),
            ...(Array.isArray(it.teams) ? it.teams : [])
          ].join(' ').toLowerCase();
          if(!hay.includes(query)) return false;
        }
        return true;
      });

      // Normalize fields
      filtered = filtered.map(it => ({
        ...it,
        _start: it.startTime ? new Date(it.startTime) : null,
        _end: it.endTime ? new Date(it.endTime) : null
      }));

      // Split groups
      const live = filtered.filter(it => it.status === 'live')
        .sort((a,b) => (b._start?.getTime()||0) - (a._start?.getTime()||0)); // newest live first

      // "Recent" = done or upcoming but within same day or last ~6 hours for done
      const isToday = (d) => d && sameDay(d, now);
      const recentDone = filtered.filter(it => it.status === 'done')
        .filter(it => it._end ? hoursDiff(it._end, now) <= 6 || isToday(it._end) : isToday(it._start))
        .sort((a,b) => (b._end?.getTime()||b._start?.getTime()||0) - (a._end?.getTime()||a._start?.getTime()||0));

      const recentUpcoming = filtered.filter(it => it.status === 'upcoming')
        .filter(it => it._start && (isToday(it._start) || it._start - now <= 4*3600*1000)) // today or within next 4h
        .sort((a,b) => (a._start?.getTime()||0) - (b._start?.getTime()||0)); // nearest first

      // Older = everything else (done older than recent window, and upcoming beyond window)
      const rest = filtered.filter(it => !live.includes(it) && !recentDone.includes(it) && !recentUpcoming.includes(it))
        .sort((a,b) => (b._end?.getTime()||b._start?.getTime()||0) - (a._end?.getTime()||a._start?.getTime()||0));

      // Paint
      mount(liveList, live);
      mount(recentList, [...recentUpcoming, ...recentDone]); // show upcoming first then recent results
      mount(olderList, rest);

      liveSec.hidden = live.length === 0;
      recentSec.hidden = (recentUpcoming.length + recentDone.length) === 0;
      olderSec.hidden = rest.length === 0;
    }

    function sameDay(a,b){
      return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
    }
    function hoursDiff(a,b){ return Math.abs(a - b)/36e5; }

    function mount(el, items){
      el.innerHTML = '';
      items.forEach(it => {
        const li = document.createElement('div');
        li.className = 'card';
        li.setAttribute('role','listitem');

        const left = document.createElement('div');
        left.className = 'left';

        const title = document.createElement('div');
        title.className = 'title';
        const strong = document.createElement('strong');
        strong.textContent = it.title || 'Untitled Event';
        title.appendChild(strong);

        const pill = document.createElement('span');
        pill.className = 'pill ' + (it.status || 'upcoming');
        pill.textContent = it.status === 'live' ? 'Live Now' : it.status === 'done' ? 'Completed' : 'Upcoming';
        title.appendChild(pill);

        left.appendChild(title);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const t = formatWhen(it);
        if(t) meta.appendChild(spanMini('🕒 '+t));
        if(it.venue) meta.appendChild(spanMini('📍 '+it.venue));
        if(it.note) meta.appendChild(spanMini('📝 '+it.note));
        left.appendChild(meta);

        const right = document.createElement('div');
        right.className = 'right';

        if(Array.isArray(it.teams) && it.teams.length){
          const scores = document.createElement('div');
          scores.className = 'scores';
          scores.appendChild(document.createTextNode(it.teams[0] || '—'));
          const mid = document.createElement('span'); mid.className='vs'; mid.textContent = it.score ? ( ' '+it.score+' ' ) : '  vs  ';
          scores.appendChild(mid);
          scores.appendChild(document.createTextNode(it.teams[1] || '—'));
          right.appendChild(scores);
        } else if (it.score){
          right.appendChild(spanMini(it.score));
        }

        li.appendChild(left);
        li.appendChild(right);
        el.appendChild(li);
      });
    }

    function spanMini(txt){
      const s = document.createElement('span'); s.className='mini'; s.textContent = txt; return s;
    }

    function formatWhen(it){
      // Show start time or start–end if done (local timezone)
      const s = it._start, e = it._end;
      if(it.status === 'done'){
        if(s && e){ return dateTimeRange(s,e); }
        if(e){ return 'Ended '+friendly(e); }
      }
      if(it.status === 'live'){
        if(s){ return 'Started '+friendly(s); }
        return 'Live';
      }
      if(it.status === 'upcoming'){
        if(s){ return 'Starts '+friendly(s); }
      }
      return '';
    }

    function friendly(dt){
      // e.g. "Today 3:10 PM" / "Yesterday 9:05 AM" / "17 Jan, 7:30 PM"
      const now = new Date();
      const opts = { hour:'numeric', minute:'2-digit' };
      const same = sameDay(dt, now);
      const yest = (()=>{ const y=new Date(now); y.setDate(now.getDate()-1); return sameDay(dt,y); })();
      const time = dt.toLocaleTimeString([], opts);
      if(same) return 'Today '+time;
      if(yest) return 'Yesterday '+time;
      return dt.toLocaleString([], { day:'2-digit', month:'short' })+', '+time;
    }

    function dateTimeRange(s,e){
      const sameD = sameDay(s,e);
      const timeFmt = { hour:'numeric', minute:'2-digit' };
      if(sameD){
        return s.toLocaleString([], { day:'2-digit', month:'short' })+' '+s.toLocaleTimeString([], timeFmt)+' – '+e.toLocaleTimeString([], timeFmt);
      }
      return friendly(s)+' – '+friendly(e);
    }
  </script>
</body>
</html>
